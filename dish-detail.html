// -----------------------------
// Dish Detail Logic
// -----------------------------

// Same key as dish.js
const DISHES_KEY = "dojo_dishes";

// Utility
function getDishes() {
  const stored = localStorage.getItem(DISHES_KEY);
  return stored ? JSON.parse(stored) : [];
}

function saveDishes(list) {
  localStorage.setItem(DISHES_KEY, JSON.stringify(list));
}

// Read dish ID from URL
function getDishId() {
  const url = new URL(window.location.href);
  return url.searchParams.get("dish");
}

// Load dish object
function getDish() {
  const id = getDishId();
  return getDishes().find(d => d.id === id);
}

// Render dish + ingredients
function render() {
  const dish = getDish();
  const nameEl = document.getElementById("dishName");
  const listEl = document.getElementById("ingredientList");

  if (!dish) {
    nameEl.textContent = "Dish Not Found";
    return;
  }

  nameEl.textContent = dish.name || "Unnamed Dish";

  listEl.innerHTML = "";

  if (!dish.ingredients || dish.ingredients.length === 0) {
    listEl.innerHTML = `<p>No ingredients yet.</p>`;
    return;
  }

  dish.ingredients.forEach((ing, index) => {
    const div = document.createElement("div");
    div.className = "p-2 my-1 bg-white text-black rounded";

    div.textContent = `${ing.name} — ${ing.amount} ${ing.unit}`;

    // optional remove button
    const btn = document.createElement("button");
    btn.textContent = "✖";
    btn.className = "ml-3 text-red-600";

    btn.addEventListener("click", () => {
      dish.ingredients.splice(index, 1);
      updateDish(dish);
      render();
    });

    div.appendChild(btn);
    listEl.appendChild(div);
  });
}

// Save updates
function updateDish(updated) {
  const dishes = getDishes().map(d =>
    d.id === updated.id ? updated : d
  );
  saveDishes(dishes);
}

// Add ingredient
function addIngredient() {
  const dish = getDish();
  if (!dish) return;

  const name = prompt("Ingredient name?");
  if (!name) return;

  const amount = prompt("Amount?");
  if (!amount) return;

  const unit = prompt("Unit (g, oz, ml, etc)?") || "";

  dish.ingredients.push({ name, amount, unit });
  updateDish(dish);
  render();
}

// Setup
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("addIngredientBtn")
    .addEventListener("click", addIngredient);

  render();
});
