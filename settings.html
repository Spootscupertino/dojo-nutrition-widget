<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings</title>

  <link rel="stylesheet" href="dojo.css" />
</head>

<body class="dojo-bg">

  <div class="paper-stone rounded-xl p-6 max-w-md mx-auto mt-8">

```
<h1 class="hand-font text-3xl burned-text">Settings</h1>

<p class="text-white mt-2">
  Adjust your app preferences.
</p>

    <div class="mt-4 text-white hand-font space-y-4">
      <div>
        <p class="burned-text text-xl">USDA API Key</p>
        <p class="text-sm mt-1">Store your FoodData Central key for ingredient lookups.</p>
        <div id="keyStatus" class="text-sm mt-2"></div>
        <input id="usdaKey" class="mt-2 w-full p-2 rounded" placeholder="Enter your USDA API key" />
        <button id="saveUsdaKey" class="mt-3 bg-white text-black px-4 py-2 rounded shadow">Save Key</button>
        <button id="testUsdaKey" class="mt-2 bg-white text-black px-4 py-2 rounded shadow">Test Key with "apple"</button>
        <div id="saveStatus" class="text-sm mt-2"></div>
      </div>

      <div>
        <p><strong>Theme:</strong> (coming soon)</p>
        <p><strong>Units:</strong> (coming soon)</p>
        <p><strong>Notifications:</strong> (coming soon)</p>
      </div>
    </div>
<div class="mt-4 text-white hand-font">
  <p><strong>Theme:</strong> (coming soon)</p>
  <p><strong>Units:</strong> (coming soon)</p>
  <p><strong>Notifications:</strong> (coming soon)</p>
</div>
```

  </div>

  <!-- ðŸ”¥ USDA API KEY BLOCK -->

  <div class="paper-stone rounded-xl p-6 max-w-md mx-auto mt-8">

```
<h2 class="hand-font text-2xl burned-text">USDA API Key</h2>

<input id="usdaKeyInput" placeholder="Enter your USDA API key"
  class="mt-4 p-2 rounded w-full hand-font" />

<button onclick="saveKey()" class="mt-4 bg-white px-4 py-2 rounded shadow hand-font">
  Save Key
</button>

<button onclick="testKey()" class="mt-4 bg-white px-4 py-2 rounded shadow hand-font">
  Test Key with 'apple'
</button>

<p id="keyStatus" class="text-white mt-4 hand-font"></p>
```

  </div>

  <script>
    function saveKey() {
      const key = document.getElementById('usdaKeyInput').value;
      localStorage.setItem('dojo_api_key', key);
      document.getElementById('keyStatus').textContent = 'Saved!';
    }

    async function testKey() {
      const key = localStorage.getItem('dojo_api_key');
      if (!key) {
        document.getElementById('keyStatus').textContent = 'No key saved yet.';
        return;
      }

      try {
        const res = await fetch(
          "https://api.api-ninjas.com/v1/nutrition?query=apple",
          { headers: { "X-Api-Key": key } }
        );

        if (!res.ok) throw new Error();
        const data = await res.json();
        document.getElementById('keyStatus').textContent =
          'Success! Apple calories per 100g: ' + data[0].calories;

      } catch (e) {
        document.getElementById('keyStatus').textContent = 'Invalid key or API error.';
      }
    }
  </script>

  <div style="text-align:center;margin-top:20px;">
    <a href="index.html">Search</a> |
    <a href="pantry.html">Pantry</a> |
    <a href="dish.html">Dish</a> |
    <a href="profile.html">Profile</a> |
    <a href="settings.html">Settings</a>
  </div>

  <script>
    // USDA API key helper UI
    const keyInput = document.getElementById("usdaKey");
    const statusEl = document.getElementById("saveStatus");
    const keyStatus = document.getElementById("keyStatus");
    const saveBtn = document.getElementById("saveUsdaKey");
    const testBtn = document.getElementById("testUsdaKey");

    const existing = localStorage.getItem("dojo_usda_api_key") || localStorage.getItem("dojo_api_key") || "";
    keyInput.value = existing;
    updateKeyStatus(existing);

    saveBtn.addEventListener("click", () => {
      const value = keyInput.value.trim();
      if (!value) {
        statusEl.textContent = "Please enter a key.";
        statusEl.style.color = "#f87171"; // red-400
        return;
      }

      localStorage.setItem("dojo_usda_api_key", value);
      // Also write legacy key for compatibility.
      localStorage.setItem("dojo_api_key", value);

      statusEl.textContent = "Key saved. You can search now.";
      statusEl.style.color = "#34d399"; // green-400
      updateKeyStatus(value);
    });

    function updateKeyStatus(value) {
      if (!value) {
        keyStatus.textContent = "No key stored yet.";
        keyStatus.style.color = "#fbbf24"; // amber-300
        return;
      }
      const masked = value.length > 6
        ? `${value.slice(0, 3)}â€¦${value.slice(-3)}`
        : value;
      keyStatus.textContent = `Key detected: ${masked}`;
      keyStatus.style.color = "#34d399"; // green-400
    }

    async function testKey() {
      statusEl.textContent = "Testing with \"apple\"...";
      statusEl.style.color = "#60a5fa"; // blue-400

      const key = localStorage.getItem("dojo_usda_api_key") || localStorage.getItem("dojo_api_key");
      if (!key) {
        statusEl.textContent = "No key saved. Please save your key first.";
        statusEl.style.color = "#f87171"; // red-400
        return;
      }

      try {
        const url = `https://api.nal.usda.gov/fdc/v1/foods/search?query=apple&pageSize=1&dataType=Foundation,SR%20Legacy,Survey%20(FNDDS)&api_key=${encodeURIComponent(key)}`;
        const res = await fetch(url);
        const text = await res.text();
        if (!res.ok) throw new Error(`${res.status} ${text}`);
        statusEl.textContent = "Test succeeded. You can search now.";
        statusEl.style.color = "#34d399"; // green-400
      } catch (err) {
        statusEl.textContent = `Test failed: ${err.message}`;
        statusEl.style.color = "#f87171"; // red-400
      }
    }

    testBtn.addEventListener("click", testKey);
  </script>

</body>
</html>
